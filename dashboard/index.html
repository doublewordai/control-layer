<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/png" href="/favicon.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            rel="preload"
            href="/src/assets/onwards-logo.svg"
            as="image"
            fetchpriority="high"
        />
        <title>Doubleword Control Layer</title>
        <script>
            (function (window, document) {
                const CONSENT_KEY = "analytics_consent";

                const ConsentManager = {
                    integrations: {},
                    loaded: false,

                    hasConsent() {
                        return localStorage.getItem(CONSENT_KEY) === "true";
                    },

                    grantConsent() {
                        localStorage.setItem(CONSENT_KEY, "true");
                        this.loadAll();
                        document.getElementById(
                            "consent-banner",
                        ).style.display = "none";
                    },

                    revokeConsent() {
                        localStorage.setItem(CONSENT_KEY, "false");
                        Object.values(this.integrations).forEach((i) => {
                            if (typeof i.onRevoke === "function") {
                                i.onRevoke();
                            }
                        });
                        document.getElementById(
                            "consent-banner",
                        ).style.display = "none";
                    },

                    register(name, integration) {
                        this.integrations[name] = integration;
                        if (this.hasConsent()) {
                            this.load(name);
                        }
                    },

                    load(name) {
                        if (this.loaded) return;
                        const integration = this.integrations[name];
                        if (
                            integration &&
                            typeof integration.load === "function"
                        ) {
                            integration.load();
                        }
                    },

                    loadAll() {
                        if (this.loaded) return;
                        this.loaded = true;
                        Object.values(this.integrations).forEach((i) => {
                            if (typeof i.load === "function") {
                                i.load();
                            }
                        });
                    },
                };

                window.ConsentManager = ConsentManager;

                if (ConsentManager.hasConsent()) {
                    ConsentManager.loadAll();
                }
            })(window, document);
        </script>
        <style>
            #consent-banner {
                display: none;
                position: fixed;
                bottom: 24px;
                right: 24px;
                background: #2d2d2d;
                color: #e0e0e0;
                padding: 20px 24px;
                border-radius: 8px;
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                font-size: 14px;
                line-height: 1.5;
                max-width: 340px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                z-index: 10000;
            }
            #consent-banner p {
                margin: 0 0 14px 0;
            }
            #consent-banner a {
                color: #e0e0e0;
                text-decoration: underline;
            }
            #consent-banner .consent-buttons {
                display: flex;
                gap: 12px;
                align-items: center;
            }
            #consent-banner .consent-btn {
                border: none;
                cursor: pointer;
                font-size: 13px;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                padding: 8px 18px;
                border-radius: 20px;
                font-family: inherit;
            }
            #consent-banner .consent-btn-accept {
                background: #f5f5f5;
                color: #2d2d2d;
            }
            #consent-banner .consent-btn-deny {
                background: transparent;
                color: #b0b0b0;
                padding: 8px 12px;
            }
            #consent-banner .consent-btn-accept:hover {
                background: #ffffff;
            }
            #consent-banner .consent-btn-deny:hover {
                color: #e0e0e0;
            }
        </style>
        <!-- Specific tracking providers should be loaded in bootstrap file -->
        <script src="/bootstrap.js"></script>
    </head>
    <body>
        <div id="root"></div>
        <script type="module" src="/src/main.tsx"></script>
        <div id="consent-banner">
            <p>
                We use
                <a
                    href="https://www.doubleword.ai/privacy"
                    target="_blank"
                    rel="noopener noreferrer"
                    >cookies</a
                >
                to ensure you get the best experience on our website.
            </p>
            <div class="consent-buttons">
                <button
                    class="consent-btn consent-btn-accept"
                    onclick="ConsentManager.grantConsent()"
                >
                    Accept
                </button>
                <button
                    class="consent-btn consent-btn-deny"
                    onclick="ConsentManager.revokeConsent()"
                >
                    Deny
                </button>
            </div>
        </div>
        <script>
            // Show banner only after fonts load and only if no choice made yet
            if (localStorage.getItem("analytics_consent") === null) {
                document.fonts.ready.then(function () {
                    document.getElementById("consent-banner").style.display =
                        "block";
                });
            }
        </script>
    </body>
</html>
